databaseChangeLog:
  - changeSet:
      id: 01_create_table_customer
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - tableExists:
                tableName: customer
      changes:
        - sql:
            sql: 'CREATE TABLE customer
                  (
                      id                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                      firstname          VARCHAR(255)                            NOT NULL,
                      lastname           VARCHAR(255)                            NOT NULL,
                      created_timestamp  TIMESTAMP WITH TIME ZONE                NOT NULL,
                      disabled_timestamp TIMESTAMP WITH TIME ZONE,
                      CONSTRAINT pk_customer PRIMARY KEY (id)
                  );'
  - changeSet:
      id: 02_create_table_balance
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - tableExists:
                tableName: balance
      changes:
        - sql:
            sql: 'CREATE TABLE balance
                  (
                      id          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                      balance     BIGINT                                  NOT NULL,
                      customer_id BIGINT                                  NOT NULL,
                      CONSTRAINT pk_balance PRIMARY KEY (id)
                  );'
  - changeSet:
      id: 03_create_fk_balance_on_customer
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - foreignKeyConstraintExists:
                foreignKeyName: FK_BALANCE_ON_CUSTOMER
      changes:
        - sql:
            sql: 'ALTER TABLE balance
                      ADD CONSTRAINT FK_BALANCE_ON_CUSTOMER FOREIGN KEY (customer_id) REFERENCES customer (id);'
  - changeSet:
      id: 04_create_table_operation
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - tableExists:
                tableName: operation
      changes:
        - sql:
            sql: 'CREATE TABLE operation
                  (
                      id                  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                      operation_code      VARCHAR(255)                            NOT NULL,
                      operation_timestamp TIMESTAMP WITH TIME ZONE                NOT NULL,
                      amount              BIGINT                                  NOT NULL,
                      customer_id         BIGINT                                  NOT NULL,
                      CONSTRAINT pk_operations PRIMARY KEY (id)
                  );'
  - changeSet:
      id: 05_create_fk_operations_on_customer
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - foreignKeyConstraintExists:
                foreignKeyName: FK_OPERATIONS_ON_CUSTOMER
      changes:
        - sql:
            sql: 'ALTER TABLE operation
                      ADD CONSTRAINT FK_OPERATIONS_ON_CUSTOMER FOREIGN KEY (customer_id) REFERENCES customer (id);'
  - changeSet:
      id: 06_create_table_transfer
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - tableExists:
                tableName: transfer
      changes:
        - sql:
            sql: 'CREATE TABLE transfer
                  (
                      id                     BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                      recipient_operation_id BIGINT                                  NOT NULL,
                      sender_operation_id    BIGINT                                  NOT NULL,
                      CONSTRAINT pk_transfer PRIMARY KEY (id)
                  );'
  - changeSet:
      id: 07_create_fk_transfer_on_recipient_operation
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - foreignKeyConstraintExists:
                foreignKeyName: FK_TRANSFER_ON_RECIPIENT_OPERATION
      changes:
        - sql:
            sql: 'ALTER TABLE transfer
                      ADD CONSTRAINT FK_TRANSFER_ON_RECIPIENT_OPERATION FOREIGN KEY (recipient_operation_id) REFERENCES operation (id);'
  - changeSet:
      id: 08_create_fk_transfer_on_sender_operation
      author: dipdeepcode
      preConditions:
        - onFail: MARK_RAN
          not:
            - foreignKeyConstraintExists:
                foreignKeyName: FK_TRANSFER_ON_SENDER_OPERATION
      changes:
        - sql:
            sql: 'ALTER TABLE transfer
                      ADD CONSTRAINT FK_TRANSFER_ON_SENDER_OPERATION FOREIGN KEY (sender_operation_id) REFERENCES operation (id);'